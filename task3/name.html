<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PouchDB Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .App {
            text-align: center;
        }
        #sync {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="App">
        <button id="sync">Sync</button>
        <p id="name"></p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pouchdb/7.2.2/pouchdb.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const DBS = {
                Local: new PouchDB('sbthw3'),
                Remote: new PouchDB('http://admin:password@localhost:5984/sbthw3')
            };

            const fetchAndRender = async () => {
                try {
                    const result = await DBS.Local.allDocs({ include_docs: true });
                    const doc = result.rows[0]?.doc;
                    const name = doc ? doc.name : 'Sync to get name';
                    document.getElementById('name').textContent = name;
                } catch (error) {
                    console.error('Error fetching data:', error);
                }
            };

            const syncData = () => {
                DBS.Local.sync(DBS.Remote, {
                    live: true,
                    retry: true
                }).on('change', async ({ change }) => {
                    const doc = change.docs[0];
                    const name = doc ? doc.name : 'Sync to get name';
                    document.getElementById('name').textContent = name;
                }).on('error', error => {
                    console.error('Sync error:', error);
                });
            };

            const syncButton = document.getElementById('sync');
            syncButton.addEventListener('click', fetchAndRender);

            try {
                await fetchAndRender();
                syncData();
            } catch (error) {
                console.error('Initial render error:', error);
            }
        });
    </script>
</body>
</html>
