Давайте побольше узнаем о СУБД [Vertica](https://www.vertica.com/)
--------------------------


![](imgs/vertica%20(1).png)

**_1) История развития СУБД_**
- Одноименная компания Vertica была основана в 2005 году
исследователем баз данных Майклом Стоунбрейкером.

<img src="imgs/Michael_Stonebraker_2.jpg" alt="Майкл Стоунбрейкер" style="width:300px;"/>

- Vertica Analytics Database - аналитическая [C-Store](https://ru.wikipedia.org/wiki/C-Store "Хранит данные в колонках, см подробнее")
СУБД для обработки больших объёмов данных - возникла как
исследовательский проект с открытым исходным кодом в Массачусетском технологическом институте в 2005 году. 
- В 2011 году компания HPE приобрела Vertica, что позволило СУБД получить доступ к ресурсам и опыту
новой компании в области больших данных и аналитики. После этого Vertica была интегрирована в HPE Big Data Platform и HPE Ezmeral Data Fabric.
- Позже произошла интеграция в облачные платформы, стала возможна работа через AWS, Azure и Google Cloud.
- На данный момент Vertica остается востребованным продуктом HPE для пользователей, заинтересованных в больших данных.

**_2) Инструменты для взаимодействия с СУБД_**

Первым и самым очевидным инструментов взаимодействия является 
Vertica Analytics Platform. Это официальный инструмент для работы с Vertica. Он предоставляет графический интерфейс для управления базами данных,
выполнения запросов и анализа данных.

Также можно воспользоваться SQL-клиентами: SQL Workbench, DBeaver, HeidiSQL.

Для объемных IOPS — Apache NiFi, Apache Kafka, Talend, Informatica PowerCenter + (с добавлением Hadoop) Apache Hive, Apache Spark.

**_3) Какой database engine используется в вашей СУБД?_**

Vertica использует собственный инженерный механизм, специально разработанный для работы с большими объемами данных и аналитических запросов.
Этот движок оптимизирован для выполнения операций в больших масштабах и обеспечивает высокую производительность и масштабируемость. Vertica является column-oriented СУБД,
что позволяет оптимизировать чтение больших объемов данных для аналитических запросов, минимизируя необходимость обработки избыточных данных.

Благодаря движку Vertica предлагает ряд дополнительных возможностей, таких как компрессия данных, масштабируемость по запросам и узлам.

**_4) Как устроен язык запросов в вашей СУБД? Разверните БД с данными и выполните ряд запросов._**

Vertica использует стандарт SQL для взаимодействия с данными,
что делает переход от других реляционных баз данных простым.

Обратимся к docker:

```bash
docker run -p 5433:5433 -p 5444:5444 --name vertica \
  --platform linux/amd64 \
  --env VERTICA_MEMDEBUG=2 \
  vertica/vertica-ce:11.1.0-0
```

Создадим таблицу
![](imgs/Screenshot%202024-04-20%20at%2014.31.55.png)

Делаем вставку и сделаем select.
![](imgs/Screenshot%202024-04-20%20at%2014.37.26.png)

Делаем update
![](imgs/Screenshot%202024-04-20%20at%2015.15.58.png)
![](imgs/Screenshot%202024-04-20%20at%2015.17.06.png)

Делаем delete
![](imgs/Screenshot%202024-04-20%20at%2015.19.44.png)
![](imgs/Screenshot%202024-04-20%20at%2015.21.20.png)

**_5) Распределение файлов БД по разным носителям?_**

Vertica обладает продвинутыми возможностями для распределения данных по различным физическим носителям.
Вот основные аспекты распределения файлов базы данных Vertica по разным носителям:

1. Проекции и сегментация: Одна из ключевых особенностей Vertica — использование проекций,
которые не только определяют структуру хранения таблицы в базе данных, но также и как данные
распределяются и реплицируются между узлами кластера. Проекции можно настроить так, чтобы данные были равномерно распределены (сегментированы) по всем узлам сети.
Это распределение обычно зависит от выбранной функции хеширования по одному из столбцов.

2. Использование хранилищ:
   - Disk Storage: Файлы данных обычно располагаются на жестких дисках или SSD. Vertica позволяет определить несколько местоположений хранения (storage locations) на уровне базы данных, что дает возможность размещать данные на разных физических или логических дисках.
   - Tiered Storage: Vertica поддерживает концепцию иерархии хранения, позволяющую перемещать данные между различными уровнями хранения (например, горячее, теплое и холодное хранение) в зависимости от частоты доступа и значимости данных. Это можно настроить, используя политики управления данными для автоматического перемещения данных между, например, SSD и HDD.

3. Репликация данных: Проекции в Vertica также могут быть настроены на репликацию для обеспечения высокой доступности и устойчивости к сбоям. Данные могут дублироваться на разных физических устройствах в пределах одного или нескольких узлов.

**_6) На каком языке/ах программирования написана СУБД?_**

Vertica написана преимущественно на C++ и в некоторых частях на Java:
1. C++ используется для создания основных аналитических и хранилищных компонентов Vertica, благодаря его возможностям прямого управления ресурсами,
высокой производительности и эффективному использованию памяти. Core-системы баз данных часто пишутся на C или C++, потому что эти языки предоставляют разработчикам возможность оптимизировать низкоуровневые операции и максимально эффективно реализовать алгоритмы обработки данных.

2. Java используется для разработки некоторых высокоуровневых функциональностей, например, веб-интерфейсов администрирования и управления конфигурацией, где преимущества Java в портативности, управлении памятью и широком наборе готовых библиотек делают её привлекательным выбором.

**_7) Какие типы индексов поддерживаются в БД? Приведите пример создания индексов._**

Vertica предоставляет несколько типов индексов, которые специально оптимизированы для колоночного хранения и обработки больших объемов данных.
Вот основные виды:

1. Проекции: В Vertica основным механизмом, который заменяет традиционные индексы в других СУБД, являются проекции.
Проекции — это физические представления таблицы, которые содержат все или только выбранные столбцы, и могут быть отсортированы по ключу сортировки для ускорения операций чтения. 

2. Предвычисленные столбцы (Derived Columns): Некоторые сложные вычисления можно предвычислить и сохранить в качестве столбцов в проекциях. Это ускоряет выполнение запросов, требующих этих вычислений.

3. Основной индекс (Primary Index): В Vertica основной индекс определяется на основе порядка сортировки в проекции. Это не отдельная структура данных, но Vertica использует этот порядок для оптимизации запросов.

*Пример создания проекции в Vertica*

Для создания проекции в Vertica, которая эквивалентна созданию индекса в других системах управления базами данных, вы выполняете следующую команду SQL. Предположим, у нас есть таблица orders со столбцами order_id, customer_id, order_date и amount.

Для создания проекции, отсортированной по order_date, выполните:

```sql
CREATE PROJECTION orders_projection
AS SELECT order_id, customer_id, order_date, amount
FROM orders
ORDER BY order_date;
```

Это создаст проекцию, которая оптимизирует выполнение запросов, фильтрующих или агрегирующих данные по order_date.

*Пример создания проекции с сегментированием по хешу*

Если данных очень много и они равномерно распределены, вы можете использовать хеш-сегментацию для дополнительного ускорения операций:

```sql
CREATE PROJECTION orders_hashed_projection
AS SELECT order_id, customer_id, order_date, amount
FROM orders
ORDER BY order_date
SEGMENTED BY HASH(customer_id) ALL NODES;
```


Здесь проекция сегментирована по хешу customer_id, что означает, что данные будут равномерно распределяться по узлам кластера Vertica.

**_8) Как строится процесс выполнения запросов в вашей СУБД?_**


Основные шаги выполнения запросов в Vertica:

1. Парсинг и анализ запроса: В начале процесса, когда запрос поступает в систему, он сначала анализируется и парсится.
Это включает в себя проверку синтаксиса и семантики SQL-запроса, а также преобразование запроса во внутреннее представление,
известное как логический план.

2. Оптимизация запроса: На этом этапе Vertica использует оптимизатор запросов для превращения логического плана в физический план.
Оптимизатор выбирает наилучший способ выполнения запроса, используя статистику о данных и информацию о доступной инфраструктуре.
Это может включать выбор самого быстрого способа соединения таблиц, использование индексов, разделение данных и пр.

3. Выполнение запроса: Физический план выполняется диспетчером выполнения запросов Vertica.
Если система распределенная, диспетчер распределяет задачи по разным узлам. Каждый узел обрабатывает данные локально, что уменьшает сетевую нагрузку и время ответа.

4. Агрегация результатов: После того как все узлы завершили свою часть работы, результаты агрегируются.
В зависимости от запроса это может включать сбор результатов с различных узлов, их объединение и возможно, дальнейшую фильтрацию или агрегацию.

5. Возврат результатов: Финальный результат запроса возвращается пользователю. Этот результат может быть представлен в виде стандартного SQL-результата или экспортирован в различные форматы в зависимости от потребностей пользователя.

6. Кэш результатов: Vertica также может кэшировать результаты определённых запросов для ускорения последующих запросов, особенно если ожидается, что данные не изменятся или изменятся не существенно.

**_9) Есть ли для вашей СУБД понятие «план запросов»? Если да, объясните, как работает данный этап._**

Как и многие другие СУБД, Vertica позволяет анализировать план запроса с помощью специальных SQL-команд.
Самая известная команда для этого — EXPLAIN. Используя команду EXPLAIN, вы можете получить детализированное описание того, как именно будет выполняться ваш запрос.

Пример использования EXPLAIN:
```sql
EXPLAIN SELECT * FROM my_table WHERE column = 'value';
```
На выходе вы получите описание плана, которое покажет, какие операции будут выполнены, какие индексы будут использованы, как будет осуществляться доступ к данным и другую полезную информацию, которая может помочь в оптимизации запросов.

**_10) Поддерживаются ли транзакции в вашей СУБД? Если да, то расскажите о нем. Если нет, то существует ли альтернатива?_**

Да, Vertica поддерживает транзакции.

*Обработка транзакций*
   - BEGIN: Запуск новой транзакции.
   - COMMIT: Завершение транзакции с сохранением всех изменений.
   - ROLLBACK: Отмена всех изменений, сделанных в транзакции.

Vertica особенно эффективна в работы с аналитическими запросами и большими объемами данных в аналитических и OLAP-сценариях, но она также обеспечивает надежную поддержку транзакций для операций, требующих соблюдения ACID свойств.

Следует отметить, что транзакции в аналитических СУБД как Vertica могут отличаться по своим характеристикам и оптимальности использования от транзакций в традиционных OLTP системах. Как правило, поддержка транзакций в Vertica оптимизирована для операций с большими объемами данных и сложных аналитических запросов, а не для высокочастотных операций обновления, как в OLTP СУБД.

**_11) Какие методы восстановления поддерживаются в вашей СУБД. Расскажите о них._**

Основные методы восстановления, доступные в Vertica:

1. Копии безопасности и восстановление:
   - Резервное копирование (Backup): Vertica позволяет делать полные и инкрементальные резервные копии данных. Полное резервное копирование сохраняет весь объем данных в копии, в то время как инкрементальное резервирование затрагивает только те данные, которые изменились с момента последнего резервного копирования.
   - Восстановление (Restore): После создания резервных копий данные могут быть восстановлены на ту же или на новую установку Vertica. Это может быть использовано для восстановления после катастрофического сбоя, миграции данных или дублирования среды для тестирования.

2. Экспорт и импорт:
   - Данные могут быть экспортированы в форматы, такие как CSV, и затем импортированы обратно в систему. Это полезно при переносе определённых данных между системами или при необходимости восстановления определённых сегментов данных.

3. Восстановление из снимков (Snapshots):
   - Vertica поддерживает создание снимков данных (Database Snapshots), которые могут быть использованы для восстановления базы данных до определённой точки во времени. Это особенно полезно для восстановления данных до момента сбоя или случайного удаления данных. 

4. Использование функции K-Safety:
   - Vertica использует концепцию k-безопасности (K-Safety), которая обеспечивает автоматическое дублирование данных по узлам в кластере. Это означает, что даже если один или несколько узлов выйдут из строя, система сможет продолжить работу без потери данных. Восстановление работы после сбоя узла включает в себя автоматическое перераспределение и восстановление данных с других узлов.

5. Логическое восстановление:
   - Vertica поддерживает логическое восстановление, где можно откатить или повторить SQL-операции, выполненные за определённый период времени, используя информацию из журналов транзакций. Это позволяет точно контролировать, какие данные восстанавливаются.

**_12) Расскажите про шардинг в вашей конкретной СУБД. Какие типы используются? Принцип работы._**

Шардинг в Vertica — это процесс разделения больших объемов данных на более мелкие части, которые распределяются по разным узлам или серверам в кластере.

*Типы Шардинга в Vertica*

Vertica использует два основных типа шардинга:
1. Шардинг на уровне проекций (Projection Segmenting): 
   - В Vertica данные хранятся в проекциях, которые представляют собой отсортированные представления основных таблицов с данными.
   - Каждая проекция разбивается на сегменты. Эти сегменты фактически представляют собой части проекции, размещаемые на разных узлах в кластере.
   - Сегментирование проекций позволяет выполнить параллельную обработку данных и запросов, где каждый узел обрабатывает только данные, хранящиеся на его собственных сегментах.
   - Это распределение нагрузки улучшает производительность за счет параллелизма и уменьшает общую нагрузку на каждый отдельный сервер.

2. Шардинг на уровне партиционирования таблиц (Table Partitioning):
   - Таблицы могут быть партиционированы по заданным ключам, которые обычно представляют собой столбцы в таблице. Каждый уникальный ключ определяет новый партишн.
   - Партиционирование помогает выполнению запросов, т.к. запросы могут быть направлены только на те данные, которые содержатся в нужных партишнах.
   - Это улучшает производительность за счет уменьшения количества данных, с которыми необходимо работать при выполнении запроса.

*Принцип работы шардинга в Vertica*

Шардинг в Vertica применяется при проектировании схемы данных и настройке кластера:
- При создании проекций администратор может указать, как данные должны быть сегментированы и на каких узлах размещены.
- Также администратор схемы может определить, как таблицы должны быть разделены на партиции по определенным критериям (например, по дате или по географическому признаку).
- Когда выполняется запрос, Vertica автоматически определяет, какие узлы кластера содержат необходимые данные, и направляет запросы к этим узлам. Такой подход позволяет сократить время ответа на запрос и снизить нагрузку на сеть кластера за счет меньшего объема передаваемых данных.

**_13) Возможно ли применить термины Data Mining, Data Warehousing и OLAP в вашей СУБД?_**

Да, Data Mining, Data Warehousing и OLAP могут быть применены к Vertica, поскольку эта СУБД предоставляет поддержку для широкого спектра аналитических операций, хранения больших объемов данных и многомерного анализа.

*1. Data Mining (извлечение данных)*

Vertica эффективно поддерживает Data Mining благодаря своей способности обрабатывать и анализировать огромные объемы данных в различных форматах быстро и эффективно. Vertica включает инструменты и функции, такие как машинное обучение и предиктивный анализ, которые являются ключевыми компонентами процесса Data Mining.

*2. Data Warehousing (хранилище данных)*

Vertica является идеальной системой для использования в качестве Data Warehouse благодаря ее высокой производительности, масштабируемости и способности хранить данные в столбцовом виде, что делает ее эффективной для аналитических запросов. Vertica также предлагает сильные средства сжатия данных, что снижает затраты на хранение при огромных объемах данных.

*3. OLAP (Online Analytical Processing)*

Vertica поддерживает OLAP через свои аналитические возможности и SQL-операции, позволяющие выполнять сложные аналитические и агрегатные запросы на больших объемах данных. Помимо это, Vertica поддерживает конструкции SQL для многомерного анализа, такие как оконные функции, которые являются частью OLAP-операций.

**_14) Какие методы защиты поддерживаются вашей СУБД? Шифрование трафика, модели авторизации и т.п._**

*1. Шифрование данных*
   - Шифрование на уровне диска (TDE): Vertica поддерживает шифрование таблиц на диске, что позволяет защитить данные от несанкционированного доступа при физическом взаимодействии с хранилищем. Это особенно важно для сценариев, когда необходимо соблюдать строгие нормативные требования к конфиденциальности данных.
   - Шифрование резервных копий: Vertica также поддерживает шифрование резервных копий баз данных, обеспечивая защиту данных на всех этапах их жизненного цикла.

*2. Шифрование сетевого трафика*
   - TLS/SSL: Для защиты данных, передаваемых между клиентом и сервером, а также между узлами кластера Vertica, можно использовать шифрование TLS (ранее SSL). Это предотвращает перехват и чтение данных в открытом виде при их передаче по сети.

*3. Аутентификация и авторизация*
   - Аутентификация: Vertica поддерживает множество методов аутентификации, включая:
     - Локальную аутентификацию базы данных.
     - Интеграцию с LDAP (Lightweight Directory Access Protocol) для централизованной аутентификации.
     - Интеграцию с Kerberos для более безопасной аутентификации в больших распределенных сетях.
   - Ролевая модель доступа: Vertica позволяет создавать роли и назначать пользователей этим ролям, управляя доступом к данным и операциям на основе присвоенных ролей. Это позволяет точно контролировать, кто и к каким данных имеет доступ.

**_15) Какие сообщества развивают данную СУБД? Кто в проекте имеет права на коммит и создание дистрибутива версий? Расскажите об этих людей и/или компаниях._**

Vertica — это коммерческая аналитическая база данных, разработанная и поддерживаемая компанией Vertica Systems.

*Разработка и поддержка Vertica*

[Компания HPE](https://ru.wikipedia.org/wiki/Hewlett_Packard_Enterprise) – Vertica является частью портфеля продуктов HPE.
Эта команда отвечает за разработку, тестирование, выпуск и поддержку продукта, управление версиями, добавление новых функций, исправление ошибок и оптимизация производительности.

*Права на коммит и создание дистрибутивов*

Так как Vertica не open-source проект, все изменения и обновления кода происходят внутри компании HPE. Только авторизованные сотрудники HPE имеют права на коммит изменений и создание официальных дистрибутивов Vertica.

*Основатели*

1. Майкл Стоунбрейкер (Michael Stonebraker) - один из наиболее известных и уважаемых специалистов в области баз данных.
Стоунбрейкер принимал участие в создании нескольких важных систем баз данных, включая Ingres и PostgreSQL.

2. Энди Палмер (Andy Palmer) - сооснователь, который помогал в коммерциализации технологии.
Палмер играл важную роль в управленческих аспектах развития компании Vertica, его опыт в управлении и развитии технологических стартапов был ключевым в успешном запуске Vertica.

**_16) Создайте свои собственные данные для демонстрации работы СУБД._**

Уже было сделано в демонстрации языка запросов, также можно обратиться к следующему пункту изложения.

**_17) Как продолжить самостоятельное изучение языка запросов с помощью демобазы. Если демобазы нет, то создайте ее._**

Vertica предоставляет набор демонстрационных данных, которые можно использовать для обучения:

- [VMart Database](https://www.vertica.com/docs/9.2.x/HTML/Content/Authoring/GettingStartedGuide/IntroducingVMart/IntroducingVMart.htm):
Vertica предлагает образец базы данных розничной торговли, называемый VMart. Эта база данных включает в себя данные о клиентах, заказах, продуктах и многом другом.

**_18) Где найти документацию и пройти обучение_**

*Официальная документация*

1. Официальная документация Vertica [Vertica Documentation](https://www.vertica.com/docs/). Здесь вы найдете подробные руководства, инструкции по установке, конфигурации, оптимизации производительности, а также руководства по SQL и разработке приложений.

*Обучающие курсы и сертификация*

- Vertica Academy - Это платформа для обучения, где предлагаются самообучающиеся курсы и лабораторные работы. Это хорошее место для начала, если вы новичок в Vertica или хотите углубить свои знания. Посетите Vertica Academy для доступа к курсам.

- Вебинары Vertica - Vertica регулярно проводит вебинары, которые могут охватывать различные темы, от введения в Vertica до продвинутых тем по оптимизации запросов и администрированию. Это также отличная возможность задать вопросы экспертам.

**_19) Как быть в курсе происходящего_**

Ресурсы:

1. Официальный сайт Vertica: Заходите на официальный сайт Vertica - [vertica.com](https://www.vertica.com/) -- информация о новых релизах, обновлениях, функциональностях и многое другое.

2. Блог Vertica: В блоге [blog.vertica.com](https://www.vertica.com/blog/) публикуются статьи, касающиеся лучших практик, учебных пособий, новостей об обновлениях и информации о новых возможностях.

3. Форумы и сообщества: Присоединитесь к сообществу пользователей Vertica, таким как форум Vertica [forum.vertica.com](https://forum.vertica.com/), где можно задавать вопросы, делиться опытом и получать советы от других пользователей и разработчиков.

4. Социальные сети: Следите за аккаунтами Vertica в таких социальных сетях, как Twitter, LinkedIn, где компания делится новостями и обновлениями.